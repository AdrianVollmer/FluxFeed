<!-- Modal overlay -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onclick="if (event.target === this) closeFeedFilterModal()">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-lg w-full mx-4 max-h-[80vh] flex flex-col" onclick="event.stopPropagation()">
        <!-- Header -->
        <div class="flex justify-between items-center p-4 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-xl font-bold text-gray-900 dark:text-white">Filter by Feeds</h2>
            <button onclick="closeFeedFilterModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                {% include "icons/close.html" %}
            </button>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-4">
            <form id="feed-filter-form">
                <!-- Quick actions -->
                <div class="flex gap-2 mb-4">
                    <button type="button" onclick="selectAllFeeds()" class="btn btn-secondary text-sm py-1 px-3">Select All</button>
                    <button type="button" onclick="selectNoneFeeds()" class="btn btn-secondary text-sm py-1 px-3">Clear</button>
                </div>

                <!-- Hierarchical tree -->
                <div class="space-y-1">
                    {% for group_node in group_tree %}
                    {% include "articles/_group_tree_item.html" %}
                    {% endfor %}

                    <!-- Ungrouped feeds section -->
                    {% if !ungrouped_feeds.is_empty() %}
                    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <div class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-2">Ungrouped</div>
                        {% for feed in ungrouped_feeds %}
                        <label class="flex items-center gap-2 py-1 px-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer">
                            <input type="checkbox" name="feed_ids" value="{{ feed.id }}"
                                   {% if feed.id|in_list(selected_feed_ids) %}checked{% endif %}
                                   class="feed-checkbox rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500">
                            {% include "components/_feed_color_dot.html" %}
                            <span class="text-sm text-gray-700 dark:text-gray-300 truncate">{{ feed.title }}</span>
                        </label>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <!-- Empty state -->
                    {% if group_tree.is_empty() && ungrouped_feeds.is_empty() %}
                    <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                        {% include "icons/rss.html" %}
                        <p>No feeds available</p>
                        <a href="/feeds" class="text-blue-600 hover:underline text-sm">Add some feeds</a>
                    </div>
                    {% endif %}
                </div>
            </form>
        </div>

        <!-- Footer -->
        <div class="flex justify-end gap-3 p-4 border-t border-gray-200 dark:border-gray-700">
            <button type="button" onclick="closeFeedFilterModal()" class="btn btn-secondary">
                Cancel
            </button>
            <button type="button" onclick="applyFeedFilter()" class="btn btn-primary">
                Apply Filter
            </button>
        </div>
    </div>
</div>
