<div class="group-container">
    <!-- Group row with checkbox -->
    <label class="flex items-center gap-2 py-1 px-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer font-medium">
        <input type="checkbox" name="group_ids" value="{{ group_node.group.id }}"
               {% if group_node.group.id|in_list(selected_group_ids) %}checked{% endif %}
               class="group-checkbox rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500">
        <svg class="w-4 h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
        </svg>
        <span class="text-sm text-gray-700 dark:text-gray-300">{{ group_node.group.name }}</span>
    </label>

    <!-- Child feeds -->
    {% for feed in group_node.feeds %}
    <label class="flex items-center gap-2 py-1 px-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer ml-6">
        <input type="checkbox" name="feed_ids" value="{{ feed.id }}"
               {% if feed.id|in_list(selected_feed_ids) %}checked{% endif %}
               class="feed-checkbox rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500">
        <span class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: {{ feed.color }}"></span>
        <span class="text-sm text-gray-700 dark:text-gray-300 truncate">{{ feed.title }}</span>
    </label>
    {% endfor %}

    <!-- Child groups - flatten to single level for simplicity -->
    {% for child_group in group_node.children %}
    <div class="ml-4">
        <label class="flex items-center gap-2 py-1 px-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer font-medium">
            <input type="checkbox" name="group_ids" value="{{ child_group.group.id }}"
                   {% if child_group.group.id|in_list(selected_group_ids) %}checked{% endif %}
                   class="group-checkbox rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500">
            <svg class="w-4 h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
            </svg>
            <span class="text-sm text-gray-700 dark:text-gray-300">{{ child_group.group.name }}</span>
        </label>

        {% for feed in child_group.feeds %}
        <label class="flex items-center gap-2 py-1 px-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer ml-6">
            <input type="checkbox" name="feed_ids" value="{{ feed.id }}"
                   {% if feed.id|in_list(selected_feed_ids) %}checked{% endif %}
                   class="feed-checkbox rounded border-gray-300 dark:border-gray-600 text-blue-600 focus:ring-blue-500">
            <span class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: {{ feed.color }}"></span>
            <span class="text-sm text-gray-700 dark:text-gray-300 truncate">{{ feed.title }}</span>
        </label>
        {% endfor %}
    </div>
    {% endfor %}
</div>
