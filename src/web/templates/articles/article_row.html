<article class="card {% if item.article.is_read %}opacity-60{% endif %} transition-opacity border-l-4" id="article-{{ item.article.id }}" style="border-left-color: {{ item.feed_color }}">
    <div class="flex gap-4">
        {# Read/Unread indicator #}
        <div class="flex-shrink-0 pt-1">
            <button
                hx-post="/articles/{{ item.article.id }}/toggle-read"
                hx-target="#article-{{ item.article.id }}"
                hx-swap="outerHTML"
                class="w-3 h-3 rounded-full border-2 {% if item.article.is_read %}bg-gray-400 border-gray-400{% else %}bg-blue-600 border-blue-600{% endif %} hover:scale-125 transition-transform"
                title="{% if item.article.is_read %}Mark as unread{% else %}Mark as read{% endif %}">
            </button>
        </div>

        {# OpenGraph Image (if available) #}
        {% if item.article.og_image.is_some() %}
        <div class="flex-shrink-0 hidden sm:block">
            <img
                src="{{ item.article.og_image.as_ref().unwrap() }}"
                alt="{{ item.article.title }}"
                class="w-32 h-32 object-cover rounded"
                loading="lazy"
                onerror="this.style.display='none'">
        </div>
        {% endif %}

        <div class="flex-1 min-w-0">
            {# Article header #}
            <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-2">
                <h3 class="text-lg font-semibold {% if item.article.is_read %}text-gray-600 dark:text-gray-400{% endif %}">
                    {% if item.article.url.is_some() %}
                    <a href="{{ item.article.url.as_ref().unwrap() }}" target="_blank" rel="noopener noreferrer" class="hover:text-blue-600 dark:hover:text-blue-400"
                       onclick="htmx.ajax('POST', '/articles/{{ item.article.id }}/mark-read', {target:'#article-{{ item.article.id }}', swap:'outerHTML'})">
                        {{ item.article.title }}
                        {% include "icons/external-link.html" %}
                    </a>
                    {% else %}
                    {{ item.article.title }}
                    {% endif %}
                </h3>

                <div class="flex gap-2 flex-shrink-0">
                    {% set is_compact = false %}
                    {% include "articles/_action_icons.html" %}
                </div>
            </div>

            {# Article metadata #}
            <div class="flex flex-wrap items-center gap-3 text-sm text-gray-600 dark:text-gray-400 mb-3">
                <span class="flex items-center">
                    {% include "icons/calendar.html" %}
                    {% if item.article.published_at.is_some() %}
                    {{ item.article.published_at.as_ref().unwrap().format("%b %d, %Y %H:%M") }}
                    {% else %}
                    No date
                    {% endif %}
                </span>

                {% if item.article.author.is_some() %}
                <span class="flex items-center">
                    {% include "icons/user.html" %}
                    {{ item.article.author.as_ref().unwrap() }}
                </span>
                {% endif %}

                {% if item.article.og_site_name.is_some() %}
                <span class="text-xs px-2 py-1 rounded bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                    {{ item.article.og_site_name.as_ref().unwrap() }}
                </span>
                {% endif %}

                <span class="text-xs px-2 py-1 rounded" style="background-color: {{ item.feed_color }}20; color: {{ item.feed_color }};">
                    {{ item.feed_title }}
                </span>

                {% for tag in item.tags %}
                {% include "components/_tag_pill.html" %}
                {% endfor %}
            </div>

            {# Article summary/content #}
            {% if item.article.summary.is_some() %}
            <div class="article-content-wrapper">
                <div class="prose dark:prose-invert prose-sm max-w-none text-gray-700 dark:text-gray-300 article-content">
                    {{ item.article.summary.as_ref().unwrap()|safe }}
                </div>
                <button class="text-sm text-blue-600 dark:text-blue-400 hover:underline mt-2 toggle-content">
                    Show more
                </button>
            </div>
            {% else if item.article.content.is_some() %}
            <div class="article-content-wrapper">
                <div class="prose dark:prose-invert prose-sm max-w-none text-gray-700 dark:text-gray-300 article-content">
                    {{ item.article.content.as_ref().unwrap()|safe }}
                </div>
                <button class="text-sm text-blue-600 dark:text-blue-400 hover:underline mt-2 toggle-content">
                    Show more
                </button>
            </div>
            {% else if item.article.og_description.is_some() %}
            <div class="prose dark:prose-invert prose-sm max-w-none text-gray-700 dark:text-gray-300">
                {{ item.article.og_description.as_ref().unwrap() }}
            </div>
            {% endif %}
        </div>
    </div>
</article>
