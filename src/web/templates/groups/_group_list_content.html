{% if tree_items.is_empty() && ungrouped_feeds.is_empty() %}
<div class="card text-center py-12">
    <p class="text-gray-600 dark:text-gray-400 mb-4">
        No groups or feeds yet. Create a group to organize your feeds!
    </p>
    <button
        hx-get="/groups/new"
        hx-target="#group-form-modal"
        hx-swap="innerHTML"
        class="btn btn-primary">
        + Create Your First Group
    </button>
</div>
{% else %}

<!-- Tree view of groups -->
<div class="card">
    {% for item in tree_items %}
    {% match item %}
    {% when crate::domain::models::FlatTreeItem::Group with { group, depth } %}
    <!-- Group item -->
    <div class="group-tree-item rounded transition-colors"
         style="margin-left: {{ depth * 24 }}px;"
         data-drop-id="{{ group.id }}"
         data-drop-type="group">
        <div class="flex items-center gap-2 px-2 py-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
            <!-- Drag handle (this is the only draggable part) -->
            <div class="drag-handle cursor-grab active:cursor-grabbing p-1 -m-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
                 data-drag-type="group"
                 data-drag-id="{{ group.id }}">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path>
                </svg>
            </div>
            <!-- Folder icon -->
            <svg class="w-4 h-4 text-yellow-500 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
            </svg>
            <!-- Group name (clickable to edit) -->
            <button
                hx-get="/groups/{{ group.id }}/edit"
                hx-target="#group-form-modal"
                hx-swap="innerHTML"
                class="text-sm font-medium text-gray-800 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 text-left flex-1 truncate">
                {{ group.name }}
            </button>
        </div>
    </div>

    {% when crate::domain::models::FlatTreeItem::Feed with { feed, depth } %}
    <!-- Feed item -->
    <div class="flex items-center gap-2 px-2 py-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700"
         style="margin-left: {{ depth * 24 }}px;">
        <!-- Drag handle -->
        <div class="drag-handle cursor-grab active:cursor-grabbing p-1 -m-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
             data-drag-type="feed"
             data-drag-id="{{ feed.id }}">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path>
            </svg>
        </div>
        <span class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: {{ feed.color }}"></span>
        <a href="/feeds/{{ feed.id }}" class="text-sm text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 flex-1 truncate">
            {{ feed.title }}
        </a>
    </div>
    {% endmatch %}
    {% endfor %}

    <!-- Ungrouped section (drop target for removing from groups) -->
    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"
         data-drop-id=""
         data-drop-type="ungrouped">
        <div class="flex items-center gap-2 px-2 py-1 text-gray-500 dark:text-gray-400">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
            </svg>
            <span class="text-sm font-medium">Ungrouped Feeds</span>
        </div>
        <div class="ml-6 space-y-0.5 mt-1">
            {% for feed in ungrouped_feeds %}
            <div class="flex items-center gap-2 px-2 py-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700">
                <!-- Drag handle -->
                <div class="drag-handle cursor-grab active:cursor-grabbing p-1 -m-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
                     data-drag-type="feed"
                     data-drag-id="{{ feed.id }}">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path>
                    </svg>
                </div>
                <span class="w-3 h-3 rounded-full flex-shrink-0" style="background-color: {{ feed.color }}"></span>
                <a href="/feeds/{{ feed.id }}" class="text-sm text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 flex-1 truncate">
                    {{ feed.title }}
                </a>
            </div>
            {% endfor %}
            {% if ungrouped_feeds.is_empty() %}
            <div class="px-2 py-1.5 text-sm text-gray-400 dark:text-gray-500 italic">
                Drop feeds here to ungroup them
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% endif %}
