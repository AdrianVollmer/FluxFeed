<modal-dialog title="{% if group.is_some() %}Edit Group{% else %}Create Group{% endif %}" close-target="group-form-modal">
    <form
        {% if group.is_some() %}
        hx-put="/groups/{{ group.as_ref().unwrap().id }}"
        {% else %}
        hx-post="/groups"
        {% endif %}
        hx-target="#group-list"
        hx-swap="innerHTML"
        hx-on::after-request="if(event.detail.successful) document.getElementById('group-form-modal').innerHTML = ''">

        <div class="form-group">
            <label for="name" class="form-label form-label-required">
                Group Name
            </label>
            <input
                type="text"
                id="name"
                name="name"
                required
                placeholder="e.g., Tech News"
                value="{% if group.is_some() %}{{ group.as_ref().unwrap().name }}{% endif %}"
                class="form-input"
                autofocus>
        </div>

        <div class="form-group-lg">
            <label for="parent_id" class="form-label">
                Parent Group (optional)
            </label>
            <select
                id="parent_id"
                name="parent_id"
                class="form-select">
                <option value="">No parent (top-level group)</option>
                {% for available_group in available_groups %}
                {% if group.is_none() || available_group.id != group.as_ref().unwrap().id %}
                <option value="{{ available_group.id }}"
                    {% if group.is_some() && group.as_ref().unwrap().parent_id.is_some() && group.as_ref().unwrap().parent_id.unwrap() == available_group.id %}selected{% endif %}>
                    {{ available_group.name }}
                </option>
                {% endif %}
                {% endfor %}
            </select>
            <p class="form-help">
                Optionally nest this group under another group
            </p>
        </div>

        <div class="flex {% if group.is_some() %}justify-between{% else %}justify-end{% endif %} items-center">
            {% if group.is_some() %}
            <button
                type="button"
                hx-delete="/groups/{{ group.as_ref().unwrap().id }}"
                hx-confirm="Delete '{{ group.as_ref().unwrap().name }}'? Feeds will be ungrouped but not deleted."
                hx-target="#group-list"
                hx-swap="innerHTML"
                hx-on::after-request="if(event.detail.successful) document.getElementById('group-form-modal').innerHTML = ''"
                class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300 text-sm font-medium">
                Delete Group
            </button>
            {% endif %}
            <div class="flex space-x-3">
                <button
                    type="button"
                    onclick="document.getElementById('group-form-modal').innerHTML = ''"
                    class="btn btn-secondary">
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                    {% if group.is_some() %}Save Changes{% else %}Create Group{% endif %}
                </button>
            </div>
        </div>
    </form>
</modal-dialog>
