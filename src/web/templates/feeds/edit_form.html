{% extends "base.html" %}

{% block scripts %}
<script src="{{ "feed-edit.js"|js_path }}" defer></script>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 dark:text-white">Edit Feed</h1>

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <form method="POST" action="/feeds/{{ feed.id }}/update" id="frequency-form">
            <div class="form-group-lg">
                <label for="title" class="form-label">
                    Title
                </label>
                <input type="text" id="title" name="title" value="{{ feed.title }}"
                       class="form-input"
                       required>
                <p class="form-help">
                    The display name for this feed
                </p>
            </div>

            <div class="form-group-lg">
                <label for="url" class="form-label">
                    URL
                </label>
                <input type="url" id="url" name="url" value="{{ feed.url }}"
                       class="form-input font-mono text-sm"
                       required>
                <p class="form-help">
                    The RSS/Atom feed URL
                </p>
            </div>

            <div class="form-group-lg">
                <label for="description" class="form-label">
                    Description
                </label>
                <textarea id="description" name="description" rows="3"
                          class="form-textarea">{% match feed.description %}{% when Some with (desc) %}{{ desc }}{% when None %}{% endmatch %}</textarea>
                <p class="form-help">
                    A brief description of this feed (optional)
                </p>
            </div>

            <div class="form-group-lg">
                <label for="color" class="form-label">
                    Feed Color
                </label>
                <div class="flex items-center gap-3">
                    <input type="color" id="color" name="color" value="{{ feed.color }}"
                           class="h-10 w-20 border border-gray-300 dark:border-gray-600 rounded cursor-pointer">
                    <input type="text" id="color-text" value="{{ feed.color }}"
                           class="w-28 form-input font-mono text-sm"
                           pattern="^#[0-9A-Fa-f]{6}$"
                           maxlength="7">
                </div>
                <p class="form-help">
                    This color will be used as an accent in article listings
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">
                    Fetch Frequency
                </label>

                <div class="space-y-3">
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="fetch_frequency" value="adaptive"
                               {% if feed.fetch_frequency == "adaptive" %}checked{% endif %}
                               class="mr-2">
                        <span class="dark:text-gray-200">Adaptive (uses feed's TTL, default 1 hour)</span>
                    </label>

                    {% match feed.ttl_minutes %}
                    {% when Some with (ttl) %}
                    <p class="text-sm text-gray-600 dark:text-gray-400 ml-6">
                        Feed suggests: {{ ttl }} minutes
                    </p>
                    {% when None %}
                    {% endmatch %}

                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="fetch_frequency" value="custom" id="custom-radio"
                               {% if feed.fetch_frequency != "adaptive" %}checked{% endif %}
                               class="mr-2">
                        <span class="dark:text-gray-200">Custom:</span>
                        <input type="number" id="custom_hours" name="custom_hours"
                               min="1" max="168"
                               value="{% if feed.fetch_frequency != "adaptive" %}{{ feed.fetch_frequency }}{% else %}24{% endif %}"
                               class="ml-2 w-20 border border-gray-300 dark:border-gray-600 rounded px-2 py-1 dark:bg-gray-700 dark:text-white"
                               onfocus="this.previousElementSibling.previousElementSibling.checked=true">
                        <span class="ml-1 dark:text-gray-200">hours</span>
                    </label>
                </div>

                <p class="form-help">
                    Valid range: 1-168 hours (1 hour to 1 week)
                </p>
            </div>

            <div class="form-group-lg">
                <label class="form-label">
                    Tags
                </label>
                {% if all_tags.is_empty() %}
                <p class="text-gray-500 dark:text-gray-400 text-sm">
                    No tags yet. <a href="/tags" class="text-blue-600 hover:underline">Create some tags</a> first.
                </p>
                {% else %}
                <div class="flex flex-wrap gap-2">
                    {% for tag in all_tags %}
                    <label class="cursor-pointer">
                        <input type="checkbox" name="tag_ids" value="{{ tag.id }}"
                               {% if tag.id|in_list(feed_tag_ids) %}checked{% endif %}
                               class="sr-only peer">
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium transition-all
                                     peer-checked:ring-2 peer-checked:ring-offset-2 peer-checked:ring-blue-500
                                     dark:peer-checked:ring-offset-gray-800
                                     opacity-50 peer-checked:opacity-100"
                              {% if tag.style == "outline" %}
                              style="border: 2px solid {{ tag.color }}; color: {{ tag.color }};"
                              {% else if tag.style == "striped" %}
                              style="background: repeating-linear-gradient(45deg, {{ tag.color }}, {{ tag.color }} 4px, {{ tag.color }}dd 4px, {{ tag.color }}dd 8px); color: white;"
                              {% else %}
                              style="background-color: {{ tag.color }}; color: white;"
                              {% endif %}>
                            {{ tag.name }}
                        </span>
                    </label>
                    {% endfor %}
                </div>
                <p class="form-help">
                    Click tags to select or deselect them
                </p>
                {% endif %}
            </div>

            <div class="flex gap-3">
                <button type="submit"
                        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
                    Save Changes
                </button>
                <a href="/feeds/{{ feed.id }}"
                   class="px-4 py-2 bg-gray-200 dark:bg-gray-700 dark:text-white rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
