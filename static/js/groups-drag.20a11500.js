"use strict";(()=>{var r={element:null,type:null,id:null},e={active:!1,startTimer:null,clone:null,startX:0,startY:0,currentDropTarget:null};function c(t){t.setAttribute("draggable","true"),t.addEventListener("dragstart",a=>{r.element=t,r.type=t.dataset.dragType||null,r.id=t.dataset.dragId||null;let n=t.closest(".flex");if(n&&n.classList.add("opacity-50"),a.dataTransfer){a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",r.id||"");let o=n||t;a.dataTransfer.setDragImage(o,20,20)}}),t.addEventListener("dragend",()=>{let a=t.closest(".flex");a&&a.classList.remove("opacity-50"),document.querySelectorAll(".drop-highlight").forEach(n=>n.classList.remove("drop-highlight")),r={element:null,type:null,id:null}}),t.addEventListener("touchstart",u,{passive:!1}),t.addEventListener("touchmove",p,{passive:!1}),t.addEventListener("touchend",i),t.addEventListener("touchcancel",i)}function u(t){let a=this,n=t.touches[0];e.startX=n.clientX,e.startY=n.clientY,e.startTimer=setTimeout(()=>{g(a,n)},300)}function p(t){let a=t.touches[0];if(!e.active){let s=Math.abs(a.clientX-e.startX),d=Math.abs(a.clientY-e.startY);(s>10||d>10)&&e.startTimer&&clearTimeout(e.startTimer);return}t.preventDefault(),e.clone&&(e.clone.style.left=a.clientX-20+"px",e.clone.style.top=a.clientY-20+"px"),e.clone&&(e.clone.style.display="none");let n=document.elementFromPoint(a.clientX,a.clientY);e.clone&&(e.clone.style.display="");let o=n?.closest("[data-drop-id]");e.currentDropTarget&&e.currentDropTarget!==o&&e.currentDropTarget.classList.remove("drop-highlight"),o?r.type==="group"&&o.dataset.dropId===r.id||(o.classList.add("drop-highlight"),e.currentDropTarget=o):e.currentDropTarget=null}function i(){if(e.startTimer&&clearTimeout(e.startTimer),!!e.active){if(e.currentDropTarget){let t=e.currentDropTarget.dataset.dropId||"";r.type==="group"&&t===r.id||(r.type==="feed"&&r.id?htmx.ajax("PUT","/feeds/"+r.id+"/group",{target:"#group-list",swap:"innerHTML",values:{group_id:t}}):r.type==="group"&&r.id&&htmx.ajax("PUT","/groups/"+r.id+"/parent",{target:"#group-list",swap:"innerHTML",values:{parent_id:t}})),e.currentDropTarget.classList.remove("drop-highlight")}f()}}function g(t,a){e.active=!0,r.element=t,r.type=t.dataset.dragType||null,r.id=t.dataset.dragId||null;let n=t.closest(".flex");n&&n.classList.add("opacity-50");let o=n||t;e.clone=o.cloneNode(!0),e.clone.classList.add("touch-drag-clone"),e.clone.style.left=a.clientX-20+"px",e.clone.style.top=a.clientY-20+"px",document.body.appendChild(e.clone),navigator.vibrate&&navigator.vibrate(50)}function f(){if(e.active=!1,r.element){let t=r.element.closest(".flex");t&&t.classList.remove("opacity-50")}e.clone&&(e.clone.remove(),e.clone=null),document.querySelectorAll(".drop-highlight").forEach(t=>t.classList.remove("drop-highlight")),r={element:null,type:null,id:null},e.currentDropTarget=null}function T(t){t.addEventListener("dragover",a=>{a.preventDefault(),a.dataTransfer&&(a.dataTransfer.dropEffect="move"),!(r.type==="group"&&t.dataset.dropId===r.id)&&t.classList.add("drop-highlight")}),t.addEventListener("dragleave",a=>{t.contains(a.relatedTarget)||t.classList.remove("drop-highlight")}),t.addEventListener("drop",a=>{a.preventDefault(),t.classList.remove("drop-highlight");let n=t.dataset.dropId||"";r.type==="group"&&n===r.id||(r.type==="feed"&&r.id?htmx.ajax("PUT","/feeds/"+r.id+"/group",{target:"#group-list",swap:"innerHTML",values:{group_id:n}}):r.type==="group"&&r.id&&htmx.ajax("PUT","/groups/"+r.id+"/parent",{target:"#group-list",swap:"innerHTML",values:{parent_id:n}}))})}function l(){document.querySelectorAll(".drag-handle[data-drag-type]").forEach(c),document.querySelectorAll("[data-drop-id]").forEach(T)}document.addEventListener("DOMContentLoaded",l);document.body.addEventListener("htmx:afterSwap",t=>{let n=t.detail?.target;(n?.id==="group-list"||n?.closest?.("#group-list"))&&l()});})();
